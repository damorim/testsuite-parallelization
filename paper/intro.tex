\section{Introduction}
\label{sec:intro}

%% . which can disrupt the development
%% process~\cite{hilton-etal-ase2016}.\Comment{  This is often referred to as the
%% ``regression testing problem''.}

As software evolves it is expected that the number of tests and the
length of test runs increase.  Both components can add up to the
aggregate cost of running a test suite.  Dealing with high testing
costs is an important problem in software engineering research and
industrial practice.

Several approaches have been proposed in the research literature to
address the regression testing problem, with the focus mainly on test
suite minimization, prioritization, reduction, and
selection~\cite{yoo-harman-stvr2012}.  In industry, the focus has been
mainly on distributing the testing workload.  Evidence of this are the
Google TAP system~\cite{google-tap,google-ci} and the Microsoft
CloudBuild system~\cite{prasad-shulte-ieee-microsoft-ci}, which
provide distributed infrastructures to efficiently build massive
amounts of code and run tests.  Building in-house server clusters is also a
popular mechanism to distribute testing workloads.  For example, as of
August 2013, the test suite fo the Groupon PWA system, which powers the
\url{groupon.com} website, included over 19K tests.  To run all those
tests under 10m, Groupon used a cluster of 4 computers with 24 cores
each~\cite{kim-etal-fse2013}.

At large organizations, the alternative of renting cloud
services\footnote{List of popular hosting cloud services:
  \url{https://clutch.co/cloud}} or even building proprietary
infrastructures to running tests is a legitimate approach to mitigate
the regression testing problem.  However, for projects with modest
 or inexistent budgets and yet relatively heavy testing workloads, this solution may
not be economically viable.  For these cases, the use of commodity
hardware (\eg{}, existing workstations), emerges as an attractive
solution for running tests.  Furthermore, the proliferation of
multi-core CPUs and the increasing popularization of testing
frameworks and build systems, which today provide mature support for
parallelization, enable test execution speedups through increased CPU
usage~(see Section~\ref{sec:modes}).  These two elements~---~demand
for cost-effective test execution and supply of relatively inexpensive
testing infrastructures~---~led us to investigate the usage of
parallelism to speed up test execution.

%% \Mar{Fan Long
%%   (http://people.csail.mit.edu/fanl/) often uses a plot to show the
%%   exponential rise of projects in github.  Please check if you can
%%   find a reference to that or ask Fan Long what source he used (maybe
%%   browsed with public API).}

%% \begin{enumerate}
%% \item \textbf{Prevalence of long-running test suites.}
%% \item \textbf{Prevalence of test suite parallelization.}
%% \item \textbf{Developer's opinion (when parallelization not used).}    
%% \item \textbf{Speedups of parallelization (when used).}
%% \item \textbf{Issues versus benefits on using parallelization modes.}
%% \end{enumerate}

This paper reports on an empirical study we conducted to analyze the
usage and impact of low-level parallelization in speeding up testing
in open-source projects.  This is a relevant problem given the
tremendous popularity of open-source development and regression
testing research~\cite{yoo-harman-stvr2012}.  Note that
parallelization is complementary to other approaches to mitigate
testing costs such as (safe) test
selection~\cite{Rothermel:1997:SER:248233.248262} and continuous
integration~\cite{Saff:2003:RWD:951952.952340}.  The dimensions of
analysis we considered in this study are (i) potential, (iii)
adoption, and (iii) tradeoffs, (iv) speedups.

%% Each dimension
%% focuses on one aspect of the study.

The dimension \textbf{feasibility} measures the potential of
parallelization to reduce testing costs.  In the limit,
parallelization would be fruitless if all projects used short-running
test suites or if the bulk of execution cost was dominated by a single
test in the suite.  The dimension \textbf{adoption} evaluates (i) how
often existing open-source projects use parallelization schemes and
(ii) how developers involved in costly projects (not using test suite
parallelization) perceive this technology.  It is important to measure
resistance of practicioners to the technology and to understand their
reasons.  The dimension \textbf{tradeoffs} evaluates the issues and
benefits associated with\Comment{running test suites with} the use of
possible parallel configurations.  Note that the configuration choice
affects testing cost and flakiness, caused by the non-determinism
resulted from running different schedulings of test methods and
classes.  Finally, the dimension \textbf{speedups} measures the
observed impact of parallelization\Comment{~---~when used in selected
  open-source projects~---~} in running times.  We briefly summarize
each of these dimensions in the following.

%% Discovering Pareto-efficient~\cite{hwang-masud-1979}
%% configurations is important to guide practitioners and future
%% developments in this area.

%% papers also indicate the important of speeding up the testing process
%% in other industrial domain, e.g., in 
%% \Mar{Ask Milos if he can share stories on how prevalent regression
%%   testing is at Microsoft and Google, if he can explain how they run
%%   tests, and how prevalent is parallelization (in contrast to
%%   regression testing).}

%Motivated by this potential gap in regression testing,
%% More specifically, we studied how often long-running test suites occur
%% in this setting, how frequently parallelization features are used, if
%% not used why, and what are the associated drawbacks.

%% To run each test suite, we used a
%% 16GB memory Intel i7 machine\Comment{ i7-4790 Intel processor} with
%% eight virtual CPUs (four cores with two native threads each) and the
%% default Maven configuration of each project.

\vspace{1ex}\noindent\textbf{Feasibility.}~
We selected \numSubjs{} popular Java projects from \github{}
containing Maven build files~\cite{maven} to assess how prevalent
long-running test suites are.  Section~\ref{sec:eval} details our
methodology to select subjects and to isolate our experiments from
environmental noise.  Results indicate that nearly
\percentMedLongRunning{} of the projects take at least 1m to run their
test suites and \percentLongRunning{} of the projects take at least 5m
to run their suites.  Considering the \numMedLong{} projects in those
two groups, the average execution time is \averageMedLongRunning{}.
Results also show that individual tests are typically short-running,
taking often less than half a second to run.  Furthermore, we found
that only in rare cases few test cases monopolize execution cost
associated with each test suite.  \emph{Overall, our results suggest
  that test suite parallelization has the potential to optimize test
  suites.}


\vspace{1ex}\noindent\textbf{Adoption.}~ We considered two aspects in
measuring technology adoption.  First, we measured usage of
parallelism in open-source projects.  Then, we ran a survey with
developers to understand the reasons that explain resistance to using
the technology.  For the quantitative analysis we checked both
statically (parsing build files) and dynamically (monitoring execution
of build files) for the presence of parallelization.  Considering only
those projects that take longer than a minute to run their test
suites, we found that only \percentParallel{} of them use parallelism.
When correcting this value with the feedback obtained a posteriori
from developers, we realized that the proportion should be higher, of
\percentParallelUpdated{}.  For the qualitative analysis we surveyed
developers from a selection of costly projects that did not use
parallelization.  \emph{Results indicate that test suite
  parallelization is underutilized and dealing with concurrency issues
  related with parallelization (\eg{}, the extra work to organize test
  suite to avoid concurrency errors) was the main barrier for
  adoption.  Other reasons included availability of continuous
  integration services and unfamiliarity with the technology.}

%% %%RQ3
%% Given the high execution cost associated with a significant number of
%% \github{} projects, we decided to investigate usage of test
%% suite parallelization in practice.  It is important to note that modern build
%% systems (\eg{}, Maven~\cite{maven}) offer parallelization options to
%% accelerate test execution (see Section~\ref{sec:modes}).  To find how
%% popular these features are in practice, we first analyzed build files
%% \emph{statically}.  Considering the $>$1m group of projects
%% (\numMedLong{} in total), we found that 49\% (41/\numMedLong{}) of
%% them use some parallelization option.  Considering those projects that
%% take more than 5m to run (\numLong{} in total), usage of parallelism
%% increases to 59\% (19/\numLong{}).  Furthermore, we found that
%% ``forking'' virtual machines was the most prevalent parallel mode used
%% in practice.  This mode is used twice as much as any other mode used.
%% Important to note that ``forking VMs'' is perhaps the simplest of the
%% parallelization modes~--~it is provided by the build system as opposed
%% to the testing framework.  This result suggests that datarace
%% flakiness~\cite{luo-etal-fse2014} may be a concern to users as
%% ``forking'' does not exploit thread-level concurrency within each VM,
%% which can create contention on data reachable from the static
%% area~\cite{bell-kaiser-icse2014,bell-etal-esecfse2015}.  Instead, it
%% creates independent processes (\ie{}, Java VM instances) and executes
%% tests sequentially within each process. \Mar{why 32-19 did not use
%%   parallelization?}

\vspace{1ex}\noindent\textbf{Tradeoffs.}~
\Fix{bla bla bla bla bla bla bla blabla bla bla blabla bla bla blabla
  bla bla blabla bla bla blabla bla bla blabla bla bla blabla bla bla
  blabla bla bla blabla bla bla blabla bla bla blabla bla bla blabla
  bla bla blabla bla bla blabla bla bla blabla bla bla blabla bla bla
  blabla bla bla blabla bla bla blabla bla bla blabla bla bla blabla
  bla bla blabla bla bla blabla bla bla blabla bla bla blabla bla bla
  blabla bla bla blabla bla bla blabla bla bla blabla bla bla blabla
  bla bla blabla bla bla blabla bla bla blabla bla bla blabla bla bla
  blabla bla bla blabla bla bla blabla bla bla blabla bla bla blabla
  bla bla blabla bla bla blabla bla bla blabla bla bla blabla bla bla
  blabla bla bla blabla bla bla blabla bla bla blabla bla bla blabla
  bla bla blabla bla bla blabla bla bla blabla bla bla bla}

\vspace{1ex}\noindent\textbf{Speedups.}~
%% \Mar{move to here} Intuitively, benefits are
%% proportional to the cost reduction that parallelization brings.  In
%% the limit, however, the overhead of spawning virtual machines or
%% threads can even result in added cost.
\Mar{...revise with scalability results...}
As to avoid introduction of unintended noise when measuring time, we
evaluated effectiveness on projects that we knew a priori ran their
test suite in parallel by default.  Results indicate that the average
speedup of parallelization was \avgSpeedup{}x.  Although we found
cases with very high speedups (\eg{}, 9.2x), we found some cases where
speedups were insignificant.  \emph{Overall, our results suggest that
  it may not be obvious to achieve huge speedups with test suite
  parallelization.}

\Mar{write one or two lessons learned}


%% \Mar{missing connection. why parallelism?}  From these results we
%% investigated (2) how frequently the projects we considered use
%% parallelization to speedup test runs.  Our results indicate that
%% \percentParallelForLongRunning{} of long-running test suites do use
%% parallelism to speedup execution.  Given the popularity of this
%% solution, we further studied: (3) what are the causes of high
%% execution cost in individual tests (CPU vs. IO) and (4) how uniformly
%% cost is distributed across tests.  These questions help to assess the
%% impact of parallelization in test suite execution.  Intuitively,
%% IO-intensive test suites and test suites with uneven distribution of
%% cost per test are factors that limit the benefits of parallelization.
%% Results indicate that \Fix{...}  Finally, we investigated (5) what are
%% the limitations related to parallelization that could justify adoption
%% resistance.

%% To illustrate the importance of parallel test execution, \Jbc{TODO -
%% Write a paragraph motivating this paper.}

%% This paper reports an empirical study to evaluate the impact of
%% parallelization options on test execution speedup \Fix{...}\Jbc{TODO -
%% Summary of the contributions of this paper} .

%%  LocalWords:  parallelization multicore JUnit TestNG NUnit XXm YYm
%%  LocalWords:  Groupon parallelizing multi JVMs CPUs JVM Milos TODO
%%  LocalWords:  Ekstazi github CloudBuild PWA groupon criticality VM

 	
%%% Local Variables:
%%% TeX-master: "main"
%%% End:
%%  LocalWords:  jenkins API VMs datarace tradeoffs tradeoff Paretto
%%  LocalWords:  schedulings
